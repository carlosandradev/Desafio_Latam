# Intro a Express

## Desarrollo de la Clase

* Inicio: Objetivo de la sesion
* Desarrollo:
  * Conceptualizacion
  * Ejercitacion
* Cierre: Reflexion

## Inicio

* Activacion de conceptos:

```js
const tareas =[
  {text: 'Ir al Gimnasio'},
  {text: 'Buscar al niño al colegio'},
  {text: 'Pagar los gastos comunes'},
  {text: 'cargar gasolina'} 
]

fs.writeFileSync('tareas.json', JSONstrigify(tareas))


```

* Qué hace JSON.stringify en el siguiente codigo?

```js

const fs = require ('fs')

const tareas = fs.readFileSync('tareas.json', 'utf8')
tareas.forEach( (tarea) => {
  console.log(tarea)
})

```

* Que problema hay con este codigo?

```js

const {saludar, darLasGracias} = require('./modales.js')

```

* Como se deben exportar las siguientes funciones para poder importarlas de esta forma?

## Objetivo General

* Levantar un servidor con Express JS que Ofrezca una API REST para leer y agregar fdatos en un archivo JSON local
  * Crear desde el backend una ruta GET usando Express JS
  * Crear desde el backend una ruta GET para listar un conjunto de recursos en Express JS
  * Crear una ruta POST en un backend para agregar datos en un JSON local

## Desarrollo

### Que es Express

* Es un framework de JS para la creacion de servidores y API REST en un entorno de Node JS
* Lo usan empresas como: Paypal, Uber, Netfilx, Linkedin, IBM etc.
* Se usa por ser dignificativamente minimalista , sintaxis intuitiva y declarativa, poco tiempo de desarrollo.

### Que es un servidor Web

* Es una aplicacion backend creada para recibir solicitudes de aplicaciones clientes y devolver inforamcion o sitios web.
* Desde el servidor utilizaremos bases de datos para la persistencia de datos.

![](./img/Screenshot%202025-11-13%20at%2012.31.37.png)

### Instalacion de Express

* Hay que instalarlo por npm
* creamos una nueva carpeta y dentro desde la terminal ejecutamos la siguiente linea.

```
npm init -y
```
* La carpeta donde lo instalamos que no incluya Mayusculas en su nombre

* Ahora lo instalamos con la siguiente linea de comandos

```
npm install express
```

* luego debe verse express en el archivo package.json

![](./img/Screenshot%202025-11-13%20at%2012.34.49.png)

* vamos ahora a crear un proyecto titutlado Hola mundo, donde crearemos un servidor para devolver un string que diga "Helo World Express JS" en una Ruta GET/home

* Creamos un archivo index,js y escribimos el siguiente codigo

```js

const express = require ('express')
const app = express()

app.listen(3000, console.log("servidor encendido"))

app.get("/home", (req, res) => {
  res.send("Hello World Express Js")
})

```

### Levantando mi servidor

* Lo siguiente sera ejecutar el archivo ```index.js``` por la terminal para levantar el servidor

```node index.js```

* En donde deberas recibir el mensaje: servidor encendido

![](./img/Screenshot%202025-11-13%20at%2012.42.11.png)

* Ahora solo debes abrir el navegador y escribir la siguiente URL:

``` https://localhost:3000/home```

* Y veras lo siguiente

![](./img/Screenshot%202025-11-13%20at%2012.43.44.png)

### Explicando el codigo

* Se importa el paquete express y se ejcuta para obtener un enrutador (app)
```js
const express = require('express')
const app = express()
```
* Se especifica en que puerto se levantara el servidor y se declara un mensaje por consola al levantarse
```js
app.listen(3000, console.log("servidor encendido"))
```
* Se crea una ruta GET con un path/home
* Que al consultarse devolvera un String con el texto "Hello World Express JS"
```js
app.get("/home", (req, res) => {
  res.send("Hello World Express Js")
})
```
### El enrutador de Express Js

* Con la instancia app podremos crear las rutas que necesitemos. Solo hay que cumplir con la siguiente sintaxis:

```app.method( path, callback)```

*En donde:*

* app: Es una instancia de Express
* method: Es un metodo de solicitud HTTP en minuscula
* path: Es la ruta que sera consultada por la aplicacion cliente, por ejemplo /home
* callback: Es la funcion que se ejecutara cuando la ruta sea consultada

### Apagar el servidor

* Cuando levantamos un servidor de Express, este queda a la espera de soliciudes bloqueando la terminal:
![](./img/Screenshot%202025-11-13%20at%2012.54.14.png)

* Para que los cambios que hagamos en el codigo del servidor sean aplicados es necesario apagar el servidor y volverlo a levantar
* Para bajar o apagar el servidor, Cmd + C en Mac.
![](./img/Screenshot%202025-11-13%20at%2012.56.12.png)  

### Actualizando cambios

* Los cambios en el codigo no se reflejaran hasta que reiniciemos el servidor.
* Con nodemos podemos ver los cambios sin tener que estar apagando y encendiendo de nuevo.

```npm i -D nodemon``` 
* Instalamos el modulo nodemom
```js
"scripts": {
  "dev": "nodemon index.js",
  "start": "node index.js"
},
```
* En el package.json agregamos lo siguiente
```
npm run dev
```
* Finalmente levantamos el servidor

## Objetivos completados

* Crear una ruta GET en Express JS

### Arquitectura Cliente - Servidor

* La creacion de servidores consiste en permitir la comunicacion entre 2 aplicaciones que requieren compartir informacion o ejecutar funciones a partir de consultas HTTP.

* Cliente servidor

![](./img/Screenshot%202025-11-13%20at%2015.47.10.png)

* En donde tenemos un cliente que realiza una consulta y un servidor que procesa la consulta y emite una respuesta.

* Podriamos verlo como el proceso de hacer pedidos en un restaurante

![](./img/Screenshot%202025-11-13%20at%2015.49.01.png)

### El objeto request (req) y response (res)

* Los servidores disponibilizan datos y funciones a traves de rutas y en cada una de ellas tenemos acceso a 2 parametros conocidos como request y el response.

* En donde el request corresponde a la informacion de la consulta recibida en el servidor, mientras que el response sera la respuesta que le daremos a las aplicaciones clientes

![](./img/Screenshot%202025-11-13%20at%2015.51.36.png)

### EL objeto request(req) y response(res)

* En Express el request y response son objetos que podemos utilizar para obtener el detalle de la consulta y poder dar respuesta:
* Usaremos para esta clase:

  * Request
    * req.body: Devuelve el payload o cuerpo de la consulta
  
  * Response:
    * res.send(): Devuelve como respuesta de la consulta lo que sea asignado como argumento
    * res.json(): Devuelve en formato JSON lo que sea asignado como argumento

### Devolviendo un JSON en una ruta

* Frecuentemente crearemos una API REST para entregar informacion a partir de una consulta bajo el metodo GET.
* Realicemos este ejercicio

```js
[
  {
    "id": 1,
    "nombre": "Audifonos",
    "precio": 18990
  },
  {
    "id": 2,
    "nombre": "Aro de Luz",
    "precio": 21990
  }
]
```

* Ahora creemos una ruta **GET/productos** en nuestro servidor y utilicemos el objeto response de la funcion callback para devolver el JSON creado.
* Es necesario importar el modulo File System para leer el archivo productos.json y posteriormente devolverlo al cliente.

```js
const express = require('express')
const app + express()
const fs = require('fs')  

app.listen(3000, console.log("servidor encendido"))

app.get("/productos", (req, res) => {
  const productos = JSON.parse(fs.readFileSync("productos.json"))
  res.json(productos)
})
```

![](./img/Screenshot%202025-11-14%20at%2012.25.11.png)

## Objetivos completados

* Crear una ruta GET en Express JS
* Devolver un JSON local en una ruta GET

### Recibiendo un payload

* Hasta ahora solo hemos devuelto informacion a un cliente que consulta una de nuestras rutas:

![](./img/Screenshot%202025-11-14%20at%2012.33.34.png)

* Sin embargo, en muchas ocasiones necesitaremos recibir datos de parte del cliente:

![](./img/Screenshot%202025-11-14%20at%2012.41.13.png)

* El **payload** se entiende como la "carga" dentro de una consulta. En express esta carga se encuentra en el atributo **body** del objeto **request**

![](./img/Screenshot%202025-11-14%20at%2012.43.59.png)

* Al recibir datos de parte del cliente podemos utilizarlos para por ejemplo registrar un nuevo producto en nuestra base de datos (por ahora solo un json local)

* Para poder leer el payout es necesario realizar una pequeña configuracion en nuestra instancia app.
* Esta configuracion consiste en ejecutar una funcion antes de cada ruta para parsear el contenido enviado desde el cliente.
* Para entender bien lo que vamos a hacer tenemos que conocer el concepto middleware.

### Que son los middleware

* Un HTTP middleware, es una capa intermedia que envuelve la aplicacion con finalidad de procesar el request y el response.

* Los middleware pueden usarse para procesar payloads, añadir headers, comprimir los response, manejar autenticacion.

![](./img/Screenshot%202025-11-14%20at%2017.09.03.png)

### Usando un middleware en Express

![](./img/Screenshot%202025-11-14%20at%2017.09.54.png)

### Que son los middlewares?

* Estos se declaran con el metodo **.use()** de express, pasando como argumento el middleware.
* Para esto agregamos la siguiente linea en nuesro servidor

```js
const express = require('express')
const app = express()
const fs = require('fs')
app.listen(3000, console.log("Servidor endendido"))

app,use(express.json()) <-------------- Esto

app.get("/poductos", (req, res) => {
  const productos = JSON.parse(fs.redFileSync("productos.json"))
  res.json(productos)
})
```

### Creacion de una ruta POST

* Ahora creemos una ruta **POST** que sea utilizada para agregar un nuevo producto en nuestro JSON local.

```js
app.post("/productos", (req, res) => {
  const producto = req.body ------------> accedemos al payload de la consulta por medio del atributo body del request
  const productos = JSON.parse(fs.readFileSync("productos.json))
  productos.push(producto)
  fs.writeFileSync("productos.json", JSON.stringify(productos))
  res.send("producto agregado con exito")
})
```
### Agregando un nuevo producto

* Probemos nuestra ruta **POST/productos** realizando una consulta HTTP
```js
{
  "id": 3,
  "nombre": "Monitor",
  "precio": 59990
}
```

![](./img/Screenshot%202025-11-14%20at%2017.21.09.png)

* Ahora revisamos en el archivo productos.json si el producto fue agregado

![](./img/Screenshot%202025-11-14%20at%2017.22.19.png)

## Objetivos Completados

* Crear una ruta GET en Express Js
* Devolver un JSON local en una ruta GET
* Recibir un payload en una ruta POST para agregar datos en un JSON local

